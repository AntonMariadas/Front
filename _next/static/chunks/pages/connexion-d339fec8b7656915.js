(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[183],{6338:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/connexion",function(){return n(1764)}])},3892:function(e,t,n){"use strict";var r=n(5893),s=n(7814),a=n(1436);t.Z=function(e){var t=e.message;return(0,r.jsxs)("div",{className:"alert alert-dismissible alert-danger text-center mt-5",children:[(0,r.jsxs)("strong",{children:[t,"  "]}),(0,r.jsx)(s.G,{icon:a.NBC})]})}},1764:function(e,t,n){"use strict";n.r(t);var r=n(5666),s=n.n(r),a=n(5893),i=n(9669),o=n.n(i),c=n(9008),l=n(7536),u=n(9531),d=n(7294),m=n(3892),f=n(1163),h=n(4155);function p(e,t,n,r,s,a,i){try{var o=e[a](i),c=o.value}catch(l){return void n(l)}o.done?t(c):Promise.resolve(c).then(r,s)}function x(e){return function(){var t=this,n=arguments;return new Promise((function(r,s){var a=e.apply(t,n);function i(e){p(a,r,s,i,o,"next",e)}function o(e){p(a,r,s,i,o,"throw",e)}i(void 0)}))}}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){g(e,t,n[t])}))}return e}t.default=function(){var e=(0,f.useRouter)(),t=(0,d.useState)(!1),n=t[0],r=t[1],i=(0,l.cI)(),p=i.register,g=i.handleSubmit,b=i.reset,j=i.formState.errors,w=(0,d.useContext)(u.Z),N=w.isAuthenticated,y=w.setIsAuthenticated,S=w.setUser,O=w.setAuthToken,_=h.env.NEXT_PUBLIC_SPRINGBOOT_API,k=x(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o().get("".concat(_,"/api/v1/accounts/user?email=").concat(t),{headers:{Authorization:"Bearer ".concat(n)}});case 3:return r=e.sent,e.abrupt("return",r.data);case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),I=x(s().mark((function t(n){var a,i,c;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a={email:n.email,password:n.password},!N){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,o().post("".concat(_,"/api/v1/accounts/login"),a);case 6:return i=t.sent,sessionStorage.removeItem("authToken"),sessionStorage.setItem("authToken",JSON.stringify(i.data.jwtToken)),sessionStorage.removeItem("isAuthenticated"),sessionStorage.setItem("isAuthenticated",JSON.stringify(!0)),t.next=13,k(n.email,i.data.jwtToken);case 13:c=t.sent,localStorage.removeItem("user"),localStorage.setItem("user",JSON.stringify(c)),S(c),y(!0),O(i.data.jwtToken),b(),"USER"===c.role?e.push("/jobs"):"ADMIN"===c.role&&e.push("/administration"),t.next=28;break;case 23:t.prev=23,t.t0=t.catch(3),console.log(t.t0),r(!0),setTimeout((function(){r(!1)}),2e3);case 28:case"end":return t.stop()}}),t,null,[[3,23]])})));return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.default,{children:[(0,a.jsx)("title",{children:"Connexion"}),(0,a.jsx)("meta",{name:"job informatique",content:"connexion"})]}),(0,a.jsx)("section",{className:"vh-100 py-5",children:(0,a.jsx)("div",{className:"container h-100",children:(0,a.jsxs)("div",{className:"row d-flex align-items-center justify-content-center h-100",children:[(0,a.jsx)("div",{className:"col-md-8 col-lg-7 col-xl-6",children:(0,a.jsx)("img",{src:"login2.svg",className:"img-fluid",alt:"Phone image"})}),(0,a.jsx)("div",{className:"col-md-7 col-lg-5 col-xl-5 offset-xl-1 text-center",children:(0,a.jsxs)("form",{onSubmit:g(I),children:[(0,a.jsx)("div",{className:"form-floating mb-3",children:(0,a.jsx)("h2",{className:"fw-bold",children:"Connexion"})}),(0,a.jsxs)("div",{className:"form-floating mb-3",children:[(0,a.jsx)("input",v({type:"text",className:"form-control text-center ".concat(j.email?"is-invalid":""),id:"email"},p("email",{required:!0,pattern:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i}))),(0,a.jsx)("label",{htmlFor:"email",children:"Email"}),j.email&&"required"==j.email.type&&(0,a.jsx)("span",{className:"badge bg-danger",children:"L'email est requis"}),j.email&&"pattern"==j.email.type&&(0,a.jsx)("span",{className:"badge bg-warning",children:"V\xe9rifiez votre email"})]}),(0,a.jsxs)("div",{className:"form-floating mb-3",children:[(0,a.jsx)("input",v({type:"password",className:"form-control text-center ".concat(j.password?"is-invalid":""),id:"password"},p("password",{required:!0}))),(0,a.jsx)("label",{htmlFor:"password",children:"Mot de passe"}),j.password&&"required"==j.password.type&&(0,a.jsx)("span",{className:"badge bg-danger",children:"Le mot de passe est requis"})]}),(0,a.jsx)("div",{className:"d-grid gap-2",children:(0,a.jsx)("button",{className:"btn btn-lg btn-primary",type:"submit",children:"OK"})}),n&&(0,a.jsx)(m.Z,{message:"Echec de la connexion"})]})})]})})})]})}}},function(e){e.O(0,[523,669,281,774,888,179],(function(){return t=6338,e(e.s=t);var t}));var t=e.O();_N_E=t}]);